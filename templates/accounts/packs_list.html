<!-- templates/accounts/packs_list.html -->
<!DOCTYPE html>
<html lang="pt-br">
  {% load static %}
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Loja — Packs</title>
    <link rel="stylesheet" href="{% static 'css/style.css' %}" />
    <style>
      /* Estilo básico para modal CSS-only */
      .modal-backdrop {
        position: fixed;
        inset: 0;
        background: rgba(0,0,0,0.5);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 9999;
      }
      .modal {
        background: white;
        padding: 18px;
        border-radius: 8px;
        max-width: 480px;
        width: 90%;
      }
      .modal img { max-width: 120px; display:block; margin-bottom:10px; }
      .packs-grid { display:flex; gap:12px; flex-wrap:wrap; }
      .pack-card { border:1px solid #ddd; padding:12px; width:220px; border-radius:6px; }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="nav">
        <!-- usei caminhos hardcoded para evitar NoReverseMatch -->
        <a href="/">Home</a> |
        <a href="/store/">Loja</a> |
        <a href="/matches/">Jogos</a> |
        <a href="/support/">Suporte</a>
        <span style="float: right"><a href="/logout/">Sair</a></span>
      </div>

      <h2>Packs</h2>

      {% if messages %}
      <ul class="messages">
        {% for message in messages %}
        <li class="{{ message.tags }}">{{ message }}</li>
        {% endfor %}
      </ul>
      {% endif %}

      <div class="packs-grid">
        {% for p in packs %}
        <div class="pack-card">
          {% if p.image_path %}
          <img src="{% static p.image_path %}" alt="{{ p.name }}" style="max-width:160px" />
          {% endif %}
          <div class="pack-name">{{ p.name }}</div>
          <div class="pack-desc">{{ p.description }}</div>
          <div class="pack-price">Preço: {{ p.price }} coins</div>

          <!-- Form simples de compra (POST para /packs/) -->
          <form method="post" action="/packs/" style="margin-top:8px;">
            {% csrf_token %}
            <input type="hidden" name="pack_id" value="{{ p.id }}" />
            <button type="submit" class="btn">Comprar</button>
          </form>
        </div>
        {% empty %}
        <p>Nenhum pack disponível.</p>
        {% endfor %}
      </div>

      <!-- Modal CSS-only: aparece se last_win existir -->
      {% if last_win %}
      <div class="modal-backdrop" id="result">
        <div class="modal" role="dialog" aria-modal="true">
          <h3>Você abriu: {{ last_win.pack_name }}</h3>
          <div style="display:flex; gap:12px; align-items:center;">
            {% if last_win.photo_path %}
            <img src="{% static last_win.photo_path %}" alt="{{ last_win.name }}" />
            {% endif %}
            <div>
              <strong>{{ last_win.name }}</strong><br />
              Tipo: {{ last_win.type }}<br />
              Overall: {{ last_win.overall }}
            </div>
          </div>

          <form method="post" action="/packs/" style="margin-top:12px;">
            {% csrf_token %}
            <!-- botão apenas para fechar o modal: envia um POST vazio e volta, ou você pode redirecionar sem ação. -->
            <!-- Melhor: usar um link que remova a fragment; aqui apenas um botão que faz GET para /packs/ -->
            <a href="/packs/" class="btn">Fechar</a>
          </form>
        </div>
      </div>
      {% endif %}

    </div>
  </body>
</html>
