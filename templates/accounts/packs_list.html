<!-- templates/accounts/packs_list.html -->
<!DOCTYPE html>
<html lang="pt-br">
  {% load static %}
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Pacotes — DGG's Ultimate Brasileirão Team Menager</title>
    <link rel="stylesheet" href="{% static 'css/style.css' %}" />
    <style>
 :root{
  --bg-top: #030312;
  --bg-bottom: #05102a;
  --surface: rgba(255,255,255,0.02);
  --card-bg: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  --accent: #00aaff;
  --accent-2: #7b2cff;
  --accent-3: #ffb100;
  --muted: rgba(230,238,246,0.55);
  --text: #e6eef6;
  --glass-border: rgba(255,255,255,0.04);
  --shadow: 0 12px 36px rgba(1,6,20,0.7);
  --radius: 12px;
}

/* page */
body{
  margin:0;
  padding:22px;
  min-height:100vh;
  font-family: Inter, "Segoe UI", Roboto, Arial, sans-serif;
  background:
    radial-gradient(700px 400px at 10% 10%, rgba(123,44,255,0.06), transparent 12%),
    radial-gradient(700px 400px at 90% 90%, rgba(0,170,255,0.04), transparent 12%),
    linear-gradient(160deg, var(--bg-top) 0%, var(--bg-bottom) 100%);
  color:var(--text);
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
}

/* container keeps content centered */
.container{
  max-width:1100px;
  margin:0 auto;
  padding:18px;
  text-align:center; /* center headings / buttons by default */
}

/* NAV - centered */
.nav{
  display:flex;
  justify-content:center;    /* centraliza os links horizontalmente */
  align-items:center;
  gap:12px;
  margin-bottom:18px;
  flex-wrap:wrap;
  position:relative;
  padding:6px 0;
}

/* Text links inside nav */
.nav a{
  color:var(--accent);
  text-decoration:none;
  font-weight:700;
  padding:8px 12px;
  border-radius:10px;
  transition: all .14s ease;
  display:inline-block;
}

/* Visual separator (|) handled by pseudo-element if you prefer no manual | in HTML) */
/* If you keep ' | ' in the HTML you'll get separators anyway; this just gives consistent spacing. */
.nav a + a::before{
  content: "|";
  margin-right:8px;
  color: rgba(255,255,255,0.06);
  margin-left:-12px;
}

/* active / hover states */
.nav a:hover{ color:var(--accent-3); background: rgba(255,255,255,0.02); transform:translateY(-2px); }

/* ensure logout link (if inside span) is centered too */
.nav span{ display:inline-block; margin-left:6px; }
.nav span a{ color:var(--accent); }

/* headings centered */
h2{ color:var(--accent); margin:8px 0 14px; font-weight:900; }
h3{ color:var(--muted); margin:14px 0; font-weight:800; }

/* packs grid - centered cards */
.packs-grid{
  display:flex;
  gap:18px;
  flex-wrap:wrap;
  justify-content:center; /* center the cards row */
  margin-top:6px;
}

/* card */
.pack-card{
  width:260px;
  background:var(--card-bg);
  border:1px solid var(--glass-border);
  border-radius:16px;
  padding:14px;
  box-shadow:var(--shadow);
  transition:transform .18s ease, box-shadow .18s ease, border-color .18s ease;
  display:flex;
  flex-direction:column;
  justify-content:space-between;
}

.pack-card:hover{
  transform:translateY(-6px);
  border-color: rgba(0,170,255,0.12);
  box-shadow: 0 20px 48px rgba(0,10,30,0.7);
}

/* pack image */
.pack-img{
  margin-left: 14%;
  width:70%;
  height:300px;
  object-fit:cover;
  border-radius:10px;
  display:block;
  margin-bottom:10px;
  background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(0,0,0,0.08));
  border:1px solid rgba(255,255,255,0.02);
}

/* texts (centered inside card) */
.pack-name{font-weight:800; font-size:1rem; color:var(--text); margin-bottom:6px; text-align:center;}
.pack-desc{font-size:13px; color:var(--muted); margin-bottom:10px; min-height:40px; text-align:center;}
.pack-price{font-size:14px; margin-bottom:10px; color:var(--text); text-align:center;}

/* buttons centered and full width optional */
.btn{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  gap:8px;
  padding:10px 14px;
  border-radius:12px;
  border:none;
  cursor:pointer;
  font-weight:800;
  text-decoration:none;
  color:#001022;
  background:linear-gradient(90deg,var(--accent),var(--accent-2));
  box-shadow: 0 10px 26px rgba(0,170,255,0.08);
  transition: transform .12s ease, filter .12s ease;
}

.btn:hover{ transform:translateY(-3px); filter:brightness(1.05); }

.btn.ghost{
  background:transparent;
  color:var(--accent);
  border:1px solid rgba(0,170,255,0.12);
  box-shadow:none;
}

/* If you want the primary Buy button to be full width inside the card */
.pack-card form button.btn{ width:100%; margin-top:10px; }

/* small muted helper */
.muted{color:var(--muted); font-size:13px;}

/* players preview inside pack */
.pack-players{margin-top:12px; padding-top:12px; border-top:1px dashed rgba(255,255,255,0.03);}
.section-title{font-size:13px; font-weight:800; color:var(--text); margin-bottom:8px; text-align:left; padding-left:6px;}

.players-grid{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  justify-content:center;
}

.player-thumb{
  width:120px;
  text-align:center;
  font-size:12px;
  color:var(--text);
}

.player-thumb img{
  width:100px;
  height:140px;
  object-fit:cover;
  border-radius:10px;
  display:block;
  margin:0 auto 6px;
  border:1px solid rgba(255,255,255,0.02);
  background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(0,0,0,0.04));
  box-shadow: 0 6px 18px rgba(0,0,0,0.6);
  
}

/* messages list (success/info) centered */
.messages{list-style:none; padding:0; margin:8px 0 12px 0; display:flex; flex-direction:column; align-items:center;}
.messages li{
  width:100%;
  max-width:720px;
  padding:10px 12px;
  border-radius:10px;
  margin-bottom:8px;
  background: linear-gradient(90deg, rgba(0,255,136,0.06), rgba(123,44,255,0.03));
  border:1px solid rgba(0,255,136,0.06);
  color:var(--text);
  font-weight:700;
  text-align:center;
}

/* modal (centered) */
.modal-backdrop{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.55);
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:9999;
  padding:20px;
}

.modal{
  width:100%;
  max-width:600px;
  background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  border-radius:14px;
  padding:18px;
  box-shadow: 0 28px 60px rgba(0,0,0,0.7);
  border:1px solid rgba(255,255,255,0.03);
}

.modal .row{display:flex; gap:16px; align-items:center; justify-content:center;}
.modal img{width:140px; height:180px; object-fit:cover; border-radius:12px; border:1px solid rgba(255,255,255,0.03);}

/* modal text area */
.modal .row div{flex:1;}
.modal h3{margin:0; color:var(--accent); font-size:1.2rem; text-align:center;}
.modal .muted{color:var(--muted); margin-top:6px; text-align:center;}

/* footer */
footer{margin-top:28px; color:var(--muted); font-size:13px; text-align:center;}

/* accessibility focus */
a:focus, button:focus{outline:2px solid rgba(0,170,255,0.14); outline-offset:3px;}

/* responsive */
@media (max-width:920px){
  .packs-grid{justify-content:center;}
  .pack-card{width:92%;}
  .modal .row{flex-direction:column; align-items:flex-start;}
  .modal img{width:120px; height:120px;}
}

    </style>
  </head>
  <body>
    <div class="container">
      <div class="nav">
        <a href="/">Home</a> |
        <a href="/store/">Loja</a> |
        <a href="/matches/">Jogos</a>
        <span style="float: right"><a href="/logout/">Sair</a></span>
      </div>

      <h2>Packs</h2>

      {% if messages %}
      <ul class="messages">
        {% for message in messages %}
        <li class="{{ message.tags }}">{{ message }}</li>
        {% endfor %}
      </ul>
      {% endif %}

      <div class="packs-grid">
        {% for p in packs %}
        <div class="pack-card" aria-labelledby="pack-{{ p.id }}">
          {% if p.image_path %}
            <img class="pack-img" src="{% static p.image_path %}" alt="{{ p.name }}" />
          {% else %}
            <img class="pack-img" src="{% static 'images/default-pack.png' %}" alt="{{ p.name }}" />
          {% endif %}

          <div id="pack-{{ p.id }}" class="pack-name">{{ p.name }}</div>
          <div class="pack-desc">{{ p.description }}</div>
          <div class="pack-price">Preço: <strong>{{ p.price }}</strong> coins</div>

          <!-- Ver mais: abre a mesma página com ?open=<id> -->
          <div style="margin-bottom:10px;">
            <a href="/packs/?open={{ p.id }}" class="btn ghost" style="text-decoration:none;">Ver mais — Jogadores</a>
          </div>

          {% comment %}
            Se a view populou p.field_players / p.gk_players (apenas quando ?open=pack_id),
            mostramos aqui as thumbs vindas do DB.
          {% endcomment %}
          {% if p.field_players or p.gk_players %}
          <div class="pack-players">
            {% if p.field_players %}
              <div class="section-title">Jogadores de Campo</div>
              <div class="players-grid">
                {% for pl in p.field_players %}
                <div class="player-thumb" title="{{ pl.name }}">
                  {% if pl.photo_path %}
                    <img src="{% static pl.photo_path %}" alt="{{ pl.name }}" />
                  {% else %}
                    <img src="{% static 'images/default-player.png' %}" alt="Sem foto" />
                  {% endif %}
                  <div>{{ pl.name }}</div>
                </div>
                {% endfor %}
              </div>
            {% endif %}

            {% if p.gk_players %}
              <div class="section-title" style="margin-top:10px;">Goleiros</div>
              <div class="players-grid">
                {% for pl in p.gk_players %}
                <div class="player-thumb" title="{{ pl.name }}">
                  {% if pl.photo_path %}
                    <img src="{% static pl.photo_path %}" alt="{{ pl.name }}" />
                  {% else %}
                    <img src="{% static 'images/default-player.png' %}" alt="Sem foto" />
                  {% endif %}
                  <div>{{ pl.name }}</div>
                </div>
                {% endfor %}
              </div>
            {% endif %}
          </div>
          {% endif %}

          <!-- Compra: submete POST para /packs/ -->
          <form method="post" action="{% url 'buy_pack' pack_id=p.id %}">
            {% csrf_token %}
            <button type="submit" class="btn">Comprar</button>
          </form>


        </div>
        {% empty %}
        <p>Nenhum pack disponível.</p>
        {% endfor %}
      </div>

      <!-- Modal (mostrado quando last_win existe na context/session) -->
      {% if last_win %}
      <div class="modal-backdrop" id="result">
        <div class="modal" role="dialog" aria-modal="true">
          <h3 style="margin-top:0;">Você abriu: {{ last_win.pack_name }}</h3>
          <div class="row" style="margin-top:10px;">
            {% if last_win.photo_path %}
              <img src="{% static last_win.photo_path %}" alt="{{ last_win.name }}" />
            {% else %}
              <img src="{% static 'images/default-player.png' %}" alt="Sem foto" />
            {% endif %}
            <div>
              <div style="font-weight:700; font-size:18px;">{{ last_win.name }}</div>
              <div class="muted" style="margin-top:6px;">Tipo: {{ last_win.type }}</div>
              <div class="muted">Overall: {{ last_win.overall }}</div>
            </div>
          </div>

          <div style="text-align:right; margin-top:14px;">
            <a href="/packs/" class="btn">Fechar</a>
          </div>
        </div>
      </div>
      {% endif %}

      <footer>
        <div>© DGG Ultimate Brasileirao — Packs</div>
      </footer>
    </div>
  </body>
</html>
